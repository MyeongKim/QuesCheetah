{% extends 'main/base.html' %}

{% load staticfiles %}

{% block stylesheet %}
    <style>
        .chart-div{
            text-align: center;
        }

        .chart-div .show-btn{
            text-align: right;
            margin-right: 10px;
            margin-bottom: 20px;
        }
    </style>
{% endblock %}
{% block content %}
    {{ msg }}
    <h1>Welcome to dashboard page</h1>
    <div id="helper-msg"></div>
    <div class="row">
        <div class="col-sm-8 col-sm-offset-2">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <p>Question text : {{ question_text }}</p>
                        <p>Question title : {{ question_title }}</p>
                    </h3>
                </div>
                <div class="panel-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>answer_text</th>
                                <th>answer_count</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for a in answer|dictsort:"answer_num" %}
                                <tr>
                                    <th scope="row">{{ a.answer_num }}</th>
                                    <td>{{ a.answer_text }}</td>
                                    <td>{{ a.answer_count }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div class="chart-div">
                        <div class="show-btn">
                            <div class="btn-group" role="group" aria-label="...">
                                <button class="btn btn-default active" id="graph1">Graph1</button>
                                <button class="btn btn-default" id="graph2">Graph2</button>
                                <button class="btn btn-default" id="graph3">Graph3</button>
                            </div>
                        </div>
                        <canvas id="myChart1" width="600" height="400"></canvas>
                        <canvas id="myChart2" width="600" height="400"></canvas>
                        <canvas id="myChart3" width="600" height="400"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>
{% endblock %}

{% block script %}
    <script src="{% static "js/Chart.min.js" %}"></script>
    <script>
        $(document).ready(function(){
            // Get context with jQuery - using jQuery's .get() method.
            var ctx = $("#myChart1").get(0).getContext("2d");
            // This will get the first returned node in the jQuery collection.
            var colors = ["#F7464A", "#46BFBD", "#FDB45C", "#C47AC4", "#3759F0", "#2AD487", "#869091", "#721EC7", "#29E8F2"];
            var highlights = ["#FF5A5E", "#5AD3D1", "#FFC870", "#C79DC7", "#7189F5", "#6FD9A9", "#9EA7A8", "#8E47D6", "#83EDF2"];

            var data = [];
            {% for a in answer %}
                data.push({
                    'value': {{ a.answer_count }},
                    'color': colors[{{ forloop.counter0 }}],
                    'highlight': highlights[{{ forloop.counter0 }}],
                    'label': "{{ a.answer_text }}"
                });
            {% endfor %}
            var myPieChart = new Chart(ctx).Pie(data,{animateScale: true});

            var data2 = {
                labels: ["January", "February", "March", "April", "May", "June", "July"],
                datasets: [
                    {
                        label: "My First dataset",
                        fillColor: "rgba(220,220,220,0.2)",
                        strokeColor: "rgba(220,220,220,1)",
                        pointColor: "rgba(220,220,220,1)",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(220,220,220,1)",
                        data: [65, 59, 80, 81, 56, 55, 40]
                    },
                    {
                        label: "My Second dataset",
                        fillColor: "rgba(151,187,205,0.2)",
                        strokeColor: "rgba(151,187,205,1)",
                        pointColor: "rgba(151,187,205,1)",
                        pointStrokeColor: "#fff",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(151,187,205,1)",
                        data: [28, 48, 40, 19, 86, 27, 90]
                    }
                ]
            };
            var ctx2 = $("#myChart2").get(0).getContext("2d");
            var myLineChart = new Chart(ctx2).Line(data2, {});

            var data3 = {
                labels: ["January", "February", "March", "April", "May", "June", "July"],
                datasets: [
                    {
                        label: "My First dataset",
                        fillColor: "rgba(220,220,220,0.5)",
                        strokeColor: "rgba(220,220,220,0.8)",
                        highlightFill: "rgba(220,220,220,0.75)",
                        highlightStroke: "rgba(220,220,220,1)",
                        data: [6, 5, 8, 8, 5, 5, 4]
                    },
                    {
                        label: "My Second dataset",
                        fillColor: "rgba(151,187,205,0.5)",
                        strokeColor: "rgba(151,187,205,0.8)",
                        highlightFill: "rgba(151,187,205,0.75)",
                        highlightStroke: "rgba(151,187,205,1)",
                        data: [2, 4, 4, 1, 8, 2, 9]
                    },
                    {
                        label: "My 3 dataset",
                        fillColor: "rgba(151,187,205,0.5)",
                        strokeColor: "rgba(151,187,205,0.8)",
                        highlightFill: "rgba(151,187,205,0.75)",
                        highlightStroke: "rgba(151,187,205,1)",
                        data: [2, 4, 1, 4, 6, 2, 9]
                    },
                    {
                        label: "My 4 dataset",
                        fillColor: "rgba(151,187,205,0.5)",
                        strokeColor: "rgba(151,187,205,0.8)",
                        highlightFill: "rgba(151,187,205,0.75)",
                        highlightStroke: "rgba(151,187,205,1)",
                        data: [1, 4, 2, 7, 3, 4, 5]
                    }
                ]
            };
            var ctx3 = document.getElementById("myChart3").getContext("2d");
            var myBarChart = new Chart(ctx3).Bar(data3, {
                multiTooltipTemplate: "<%=datasetLabel%> : <%= value %>",
            });

            $('.show-btn button').click(function(){
                var id = $(this).attr('id');
                $('#myChart3').hide();
                $('#myChart2').hide();
                $('#myChart1').hide();

                $('#myChart'+id.slice(5)).show();

                $('.show-btn button.active').removeClass('active');
                $('.show-btn button#'+id).addClass('active');
            });

            $('#myChart2').hide();
            $('#myChart3').hide();

        });
    </script>
{% endblock %}
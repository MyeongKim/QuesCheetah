{% extends 'main/base.html' %}

{% load staticfiles %}

{% block stylesheet %}{% endblock %}
{% block content %}
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    <h3>Question select</h3>
    <div id="helper-msg"></div>
    <div class="row">
        <div class="col-sm-6">
            <div class="panel panel-default">
                <a href="{% url 'vote:new' api_key %}"><button class="btn btn-default">make a new question?</button></a>
            <hr>
                <h3>Group Questions</h3>
                {% for m in multi_question %}
                    {{ forloop.counter }}
                    <div>{{ m.group_name }}</div>
                    <a href="{% url 'vote:get_multiple_vote' api_key m.group_name %}"><button class="btn btn-default">투표하기</button></a>
                    <a href="{% url 'vote:multiple_dashboard' api_key m.group_name %}"><button class="btn btn-default">Dashboard 보기</button></a>
                    <button class="btn btn-danger multi-delete-btn" gn="{{ m.group_name }}">Delete</button>
                    <hr>
                {% endfor %}
                <hr>
                <h3>Single Questions</h3>
                {% for q in single_question %}
                    {{ forloop.counter }}
                    <div>{{ q.question_text }}</div>
                    <div>{{ q.question_title }}</div>
                    <a href="{% url 'vote:get_vote' api_key q.question_title %}"><button class="btn btn-default">투표하기</button></a>
                    <a href="{% url 'vote:dashboard' api_key q.id %}"><button class="btn btn-default">Dashboard 보기</button></a>
                    <button class="btn btn-danger single-delete-btn" qid="{{ q.id }}" qt="{{ q.question_title }}">Delete</button>
                    <hr>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
{% block script %}
    <script type="application/javascript">
        $(document).ready(function(){
            function reload(){
                location.reload();
            }

            $('.multi-delete-btn').click(function(){

                var params = {
                    'api_key': "{{ api_key }}",
                    'group_name': $(this).attr('gn')
                };
                self.pkc.deleteMultiQuestionSet(params, reload);
            });

            $('.single-delete-btn').click(function(){
                var params = {
                    'api_key': "{{ api_key }}",
                    'question_id': $(this).attr('qid'),
                    'question_title': $(this).attr('qt'),
                };
                self.pkc.deleteQuestionSet(params, reload);
            });
        });
    </script>
{% endblock %}